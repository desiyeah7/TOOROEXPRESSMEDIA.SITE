<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Viewer – Tooro Express Media</title>
<style>
body{margin:0;background:#111;color:#fff;text-align:center;font-family:Arial}
video{width:95%;max-width:900px;margin-top:20px;border-radius:12px;background:#000}
</style>
</head>
<body>
<h2 id="title">Loading…</h2>
<video id="viewerVideo" autoplay playsinline muted></video>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig={apiKey:"AIzaSyDyIloGwy7UzZUAqodgZNvNCiBou02RbGQ",authDomain:"livestream-trial.firebaseapp.com",databaseURL:"https://livestream-trial-default-rtdb.firebaseio.com",projectId:"livestream-trial",storageBucket:"livestream-trial.appspot.com"};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

const rtcConfig={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};
const viewerRef=db.ref("viewers").push();
const viewerId=viewerRef.key;
viewerRef.set(true);
viewerRef.onDisconnect().remove();

const pc=new RTCPeerConnection(rtcConfig);
const video=document.getElementById("viewerVideo");
pc.ontrack=e=>video.srcObject=e.streams[0];
pc.onicecandidate=e=>e.candidate&&db.ref(`webrtc/${viewerId}/viewerICE`).push(JSON.stringify(e.candidate));

db.ref(`webrtc/${viewerId}/offer`).on("value",async s=>{
 if(!s.val())return;
 await pc.setRemoteDescription(JSON.parse(s.val()));
 const ans=await pc.createAnswer();
 await pc.setLocalDescription(ans);
 db.ref(`webrtc/${viewerId}/answer`).set(JSON.stringify(ans));
});

db.ref(`webrtc/${viewerId}/ownerICE`).on("child_added",s=>pc.addIceCandidate(JSON.parse(s.val())));

db.ref("title").on("value",s=>document.getElementById("title").textContent=s.val()||"Live");
</script>
</body>
</html>
